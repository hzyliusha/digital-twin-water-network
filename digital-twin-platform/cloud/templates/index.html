{% extends "base.html" %}

{% block title %}首页 - 水网数字孪生平台{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">欢迎使用水网数字孪生平台</h1>
                <p class="card-text">
                    水网数字孪生是水务系统物理实体的虚拟表示，可用于实时监控、预测分析和优化决策。
                    本平台实现了云端、边缘和终端设备的协同工作，为您提供完整的水网数字孪生解决方案。
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">云端服务</h5>
                <p class="card-text">提供数据存储、处理和可视化功能，集中管理所有边缘节点和设备。</p>
                <a href="/dashboard" class="btn btn-primary">访问仪表盘</a>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">边缘节点</h5>
                <p class="card-text">负责数据采集、预处理和本地决策，在网络不稳定时可独立运行。</p>
                <a href="/devices" class="btn btn-primary">查看边缘节点</a>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">水网设备</h5>
                <p class="card-text">包括水质传感器、阀门和水泵等设备，实现物理世界与数字世界的映射。</p>
                <a href="/devices" class="btn btn-primary">管理设备</a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title">系统状态</h3>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h5 class="card-title">在线设备</h5>
                                <p class="card-text" id="online-devices-count">加载中...</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h5 class="card-title">边缘节点</h5>
                                <p class="card-text" id="edge-nodes-count">加载中...</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h5 class="card-title">今日水流量</h5>
                                <p class="card-text" id="today-data-count">加载中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取系统状态数据
        fetch('/api/devices')
            .then(response => response.json())
            .then(data => {
                const onlineDevices = data.filter(device => device.status === 'online');
                document.getElementById('online-devices-count').textContent = onlineDevices.length + ' / ' + data.length;
                
                // 获取边缘节点数量
                const edgeNodes = data.filter(device => device.type === 'edge');
                document.getElementById('edge-nodes-count').textContent = edgeNodes.length;
                
                // 模拟今日水流量
                document.getElementById('today-data-count').textContent = Math.floor(Math.random() * 100000) + ' 立方米';
            })
            .catch(error => {
                console.error('获取设备数据失败:', error);
                document.getElementById('online-devices-count').textContent = '获取失败';
                document.getElementById('edge-nodes-count').textContent = '获取失败';
                document.getElementById('today-data-count').textContent = '获取失败';
            });
    });
</script>
{% endblock %} 